<div class="settings-container">
  <header class="settings-header">
    <h1>{{ 'settings' | transloco }}</h1>
  </header>

  <div class="settings-cards">
    <div class="settings-card">
      <div class="settings-card-header">
        <div class="settings-card-icon" aria-hidden="true">
          <span class="material-icons">lock</span>
        </div>
        <div class="settings-card-info">
          <p class="settings-card-title">{{ 'mot_de_passe' | transloco }}</p>
        </div>
      </div>
      <button class="btn btn-primary" (click)="openModal(contentModalEditPass)">
        {{ 'modifier_mot_de_passe' | transloco }}
      </button>
    </div>

    <div class="settings-card">
      <div class="settings-card-header">
        <div class="settings-card-icon" aria-hidden="true">
          <span class="material-icons">email</span>
        </div>
        <div class="settings-card-info">
          <p class="settings-card-title">{{ 'mail' | transloco }}</p>
          <p class="settings-card-value">{{ mail() }}</p>
        </div>
      </div>
      <button class="btn btn-primary" (click)="openModal(contentModalEditMail)">
        {{ 'modifier_mail' | transloco }}
      </button>
    </div>

    <div class="settings-card">
      <div class="settings-card-header">
        <div class="settings-card-icon" aria-hidden="true">
          <span class="material-icons">dark_mode</span>
        </div>
        <div class="settings-card-info">
          <p class="settings-card-title">{{ 'enable_dark_mode' | transloco }}</p>
        </div>
      </div>
      <div class="form-check form-switch">
        <input
          class="form-check-input"
          type="checkbox"
          id="darkModeSwitch"
          (change)="onSwitchDarkMode()"
          [checked]="darkModeEnabled()"
        />
        <label class="form-check-label visually-hidden" for="darkModeSwitch">
          {{ 'enable_dark_mode' | transloco }}
        </label>
      </div>
    </div>

    <div class="settings-card">
      <div class="settings-card-header">
        <div class="settings-card-icon" aria-hidden="true">
          <span class="material-icons">language</span>
        </div>
        <div class="settings-card-info">
          <p class="settings-card-title">{{ 'language' | transloco }}</p>
          <p class="settings-card-value">
            {{ 'selected_language' | transloco }} : {{ 'langue_' + language() | transloco }}
          </p>
        </div>
      </div>
      <button class="btn btn-primary" (click)="openModal(contentModalEditLanguage)">
        {{ 'change_language' | transloco }}
      </button>
    </div>

    <div class="settings-card">
      <div class="settings-card-header">
        <div class="settings-card-icon" aria-hidden="true">
          <span class="material-icons">account_circle</span>
        </div>
        <div class="settings-card-info">
          <p class="settings-card-title">{{ 'associate_google_account' | transloco }}</p>
        </div>
      </div>
      <button class="btn btn-primary" (click)="openGoogleAccountModal()">
        {{ 'associate' | transloco }}
      </button>
    </div>

    <div class="settings-card settings-card-danger">
      <div class="settings-card-header">
        <div class="settings-card-icon" aria-hidden="true">
          <span class="material-icons">delete_forever</span>
        </div>
        <div class="settings-card-info">
          <p class="settings-card-title">{{ 'delete_account' | transloco }}</p>
        </div>
      </div>
      <button class="btn btn-danger" (click)="openModal(contentModalDelete)">
        {{ 'delete_account' | transloco }}
      </button>
    </div>
  </div>
</div>

<ng-template #contentModalEditPass let-modal>
  <div class="modal-header">
    <h4 class="modal-title">
      <span class="material-icons" aria-hidden="true">lock</span>
      {{ 'modifier_mot_de_passe' | transloco }}
    </h4>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    ></button>
  </div>
  <div class="modal-body">
    <form (submit)="onSubmitEditPass($event)" class="modal-form">
      <div class="form-group">
        <label class="form-label" for="passwordold">
          <span class="material-icons" aria-hidden="true">vpn_key</span>
          {{ 'mot_de_passe_actuel' | transloco }}
        </label>
        <input
          type="password"
          id="passwordold"
          class="form-control"
          ngbAutofocus
          [formField]="editPassForm.passwordold"
        />
      </div>
      <div class="form-group">
        <label class="form-label" for="password1">
          <span class="material-icons" aria-hidden="true">lock_open</span>
          {{ 'mot_de_passe_nouveau' | transloco }}
        </label>
        <input
          type="password"
          id="password1"
          class="form-control"
          [formField]="editPassForm.password1"
        />
      </div>
      <div class="form-group">
        <label class="form-label" for="password2">
          <span class="material-icons" aria-hidden="true">check_circle</span>
          {{ 'mot_de_passe_repeter' | transloco }}
        </label>
        <input
          type="password"
          id="password2"
          class="form-control"
          [formField]="editPassForm.password2"
        />
      </div>

      @if(editPassForm().dirty() && error()!=='') {
      <div class="modal-alert modal-alert-danger">
        <span class="material-icons" aria-hidden="true">error</span>
        <span>{{ error() }}</span>
      </div>
      } @if(successPass()) {
      <div class="modal-alert modal-alert-success">
        <span class="material-icons" aria-hidden="true">check_circle</span>
        <span>{{ 'mot_de_passe_modifie_succes' | transloco }}</span>
      </div>
      }

      <div class="modal-actions">
        <button type="submit" class="btn btn-primary" [disabled]="editPassForm().invalid()">
          <span class="material-icons" aria-hidden="true">save</span>
          {{ 'envoyer' | transloco }}
        </button>
      </div>
    </form>
  </div>
</ng-template>

<ng-template #contentModalEditMail let-modal>
  <div class="modal-header">
    <h4 class="modal-title">
      <span class="material-icons" aria-hidden="true">email</span>
      {{ 'modifier_mail' | transloco }}
    </h4>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    ></button>
  </div>
  <div class="modal-body">
    <form (submit)="onSubmitEditMail($event)" class="modal-form">
      <div class="form-group">
        <label class="form-label" for="mail">
          <span class="material-icons" aria-hidden="true">alternate_email</span>
          {{ 'mail' | transloco }}
        </label>
        <input
          type="text"
          id="mail"
          class="form-control"
          ngbAutofocus
          [formField]="editMailForm.mail"
        />
      </div>

      @if(editMailForm().dirty() && error()!=='') {
      <div class="modal-alert modal-alert-danger">
        <span class="material-icons" aria-hidden="true">error</span>
        <span>{{ error() }}</span>
      </div>
      } @if(successMail()) {
      <div class="modal-alert modal-alert-success">
        <span class="material-icons" aria-hidden="true">check_circle</span>
        <span>{{ 'mail_modifie_succes' | transloco }}</span>
      </div>
      }

      <div class="modal-actions">
        <button type="submit" class="btn btn-primary" [disabled]="editMailForm().invalid()">
          <span class="material-icons" aria-hidden="true">save</span>
          {{ 'envoyer' | transloco }}
        </button>
      </div>
    </form>
  </div>
</ng-template>

<ng-template #contentModalEditLanguage let-modal>
  <div class="modal-header">
    <h4 class="modal-title">
      <span class="material-icons" aria-hidden="true">language</span>
      {{ 'language' | transloco }}
    </h4>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    ></button>
  </div>
  <div class="modal-body">
    <form (submit)="onSubmitEditLanguage($event)" class="modal-form">
      <div class="form-group">
        <label class="form-label" for="language">
          <span class="material-icons" aria-hidden="true">translate</span>
          {{ 'language' | transloco }}
        </label>
        <select
          id="language"
          class="form-select"
          ngbAutofocus
          [formField]="editLanguageForm.language"
        >
          @for (lang of availableLanguages(); track lang) {
          <option [value]="lang">{{ 'langue_' + lang | transloco }}</option>
          }
        </select>
      </div>

      @if(editLanguageForm().dirty() && error()!=='') {
      <div class="modal-alert modal-alert-danger">
        <span class="material-icons" aria-hidden="true">error</span>
        <span>{{ error() }}</span>
      </div>
      } @if(successLanguage()){
      <div class="modal-alert modal-alert-success">
        <span class="material-icons" aria-hidden="true">check_circle</span>
        <span>{{ 'language_updated_succesfully' | transloco }}</span>
      </div>
      }

      <div class="modal-actions">
        <button type="submit" class="btn btn-primary" [disabled]="editLanguageForm().invalid()">
          <span class="material-icons" aria-hidden="true">save</span>
          {{ 'envoyer' | transloco }}
        </button>
      </div>
    </form>
  </div>
</ng-template>

<ng-template #contentModalDelete let-modal>
  <div class="modal-header">
    <h4 class="modal-title">
      <span class="material-icons" aria-hidden="true">delete_forever</span>
      {{ 'delete_account' | transloco }}
    </h4>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    ></button>
  </div>
  <div class="modal-body">
    <div class="modal-alert modal-alert-warning">
      <span class="material-icons" aria-hidden="true">warning</span>
      <span>{{ 'delete_account_warning' | transloco }}</span>
    </div>

    <form (submit)="onSubmitDeleteAccount($event)" class="modal-form">
      <div class="form-group">
        <label class="form-label" for="passwordDelete">
          <span class="material-icons" aria-hidden="true">vpn_key</span>
          {{ 'mot_de_passe' | transloco }}
        </label>
        <input
          type="password"
          id="passwordDelete"
          class="form-control"
          ngbAutofocus
          [formField]="deleteAccountForm.password"
        />
      </div>

      @if(deleteAccountForm().dirty() && error()!=='') {
      <div class="modal-alert modal-alert-danger">
        <span class="material-icons" aria-hidden="true">error</span>
        <span>{{ error() }}</span>
      </div>
      } @if(successDelete()){
      <div class="modal-alert modal-alert-success">
        <span class="material-icons" aria-hidden="true">check_circle</span>
        <span>{{ 'account_deleted_succesfully' | transloco }}</span>
      </div>
      }

      <div class="modal-actions">
        <button type="submit" class="btn btn-danger" [disabled]="deleteAccountForm().invalid()">
          <span class="material-icons" aria-hidden="true">delete_forever</span>
          {{ 'delete_account' | transloco }}
        </button>
      </div>
    </form>
  </div>
</ng-template>

<ng-template #contentModalAssociateGoogleAccount let-modal>
  <div class="modal-header">
    <h4 class="modal-title">
      <span class="material-icons" aria-hidden="true">account_circle</span>
      {{ 'associate_google_account' | transloco }}
    </h4>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    ></button>
  </div>
  <div class="modal-body">
    <div class="modal-alert modal-alert-info">
      <span class="material-icons" aria-hidden="true">info</span>
      <span>{{ 'associate_google_account_description' | transloco }}</span>
    </div>

    <div id="google-signin-button" class="google-signin-container"></div>

    @if(error()!=='') {
    <div class="modal-alert modal-alert-danger">
      <span class="material-icons" aria-hidden="true">error</span>
      <span>{{ error() }}</span>
    </div>
    } @if(successGoogleAccount()){
    <div class="modal-alert modal-alert-success">
      <span class="material-icons" aria-hidden="true">check_circle</span>
      <span>{{ 'associate_google_account_succesfully' | transloco }}</span>
    </div>
    }
  </div>
</ng-template>
