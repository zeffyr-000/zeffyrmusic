<div class="page-container">
  <header class="page-header">
    <h1>{{ 'mes_playlists' | transloco }}</h1>
  </header>

  <section class="create-section">
    <h2 class="create-section-title">
      <span class="material-icons" aria-hidden="true">add</span>
      {{ 'creer_nouvelle_playlist' | transloco }}
    </h2>
    <form (submit)="onCreatePlaylist($event)" class="create-form">
      <div class="form-group">
        <label class="form-label" for="new-playlist-name">
          <span class="material-icons" aria-hidden="true">title</span>
          {{ 'nom_playlist' | transloco }}
        </label>
        <input
          type="text"
          id="new-playlist-name"
          class="form-control"
          ngbAutofocus
          [formField]="createPlaylistForm.titre"
        />
      </div>
      <button class="btn btn-primary" type="submit" [disabled]="createPlaylistForm().invalid()">
        <span class="material-icons" aria-hidden="true">playlist_add</span>
        {{ 'creer' | transloco }}
      </button>
    </form>
  </section>

  <div class="playlist-list">
    @for (playlist of userDataStore.playlists(); track playlist.id_playlist) {
    <div class="playlist-item">
      <div class="playlist-info">
        <a class="playlist-title" [routerLink]="['/playlist', playlist.id_playlist]">
          {{ playlist.titre }}
        </a>
      </div>
      <div class="playlist-actions">
        <button
          class="btn btn-sm btn-visibility"
          [class.is-private]="playlist.prive"
          (click)="onSwitchVisibility(playlist.id_playlist, playlist.prive ? 'public' : 'prive')"
          ngbTooltip="{{
            (playlist.prive ? 'visibility_private_hint' : 'visibility_public_hint') | transloco
          }}"
          [attr.aria-pressed]="playlist.prive"
        >
          <span class="material-icons">{{ playlist.prive ? 'lock' : 'public' }}</span>
          {{ (playlist.prive ? 'prive' : 'public') | transloco }}
        </button>
        <div class="d-inline-flex" ngbDropdown>
          <button
            class="btn btn-sm btn-icon"
            ngbDropdownToggle
            [attr.aria-label]="'actions' | transloco"
          >
            <span class="material-icons">more_vert</span>
          </button>
          <ul ngbDropdownMenu>
            <li ngbDropdownItem>
              <button
                (click)="
                  onConfirmEditTitlePlaylist(
                    playlist.id_playlist,
                    playlist.titre,
                    contentModalConfirmEditTitle
                  )
                "
              >
                <span class="material-icons">edit</span>
                {{ 'modifier_nom' | transloco }}
              </button>
            </li>
            <li ngbDropdownItem class="dropdown-item-danger">
              <button
                (click)="
                  onConfirmDeletePlaylist(playlist.id_playlist, contentModalConfirmDeletePlaylist)
                "
              >
                <span class="material-icons">delete</span>
                {{ 'supprimer' | transloco }}
              </button>
            </li>
          </ul>
        </div>
      </div>
    </div>
    } @empty {
    <div class="empty-state">
      <span class="material-icons empty-state-icon" aria-hidden="true">playlist_add</span>
      <p class="empty-state-text">{{ 'aucune_playlist' | transloco }}</p>
    </div>
    }
  </div>
</div>

<ng-template #contentModalConfirmDeletePlaylist let-modal>
  <div class="modal-header">
    <h4 class="modal-title">
      <span class="material-icons" aria-hidden="true">delete_forever</span>
      {{ 'supprimer_playlist' | transloco }}
    </h4>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    ></button>
  </div>
  <div class="modal-body">
    <div class="modal-alert modal-alert-warning" role="alert">
      <span class="material-icons" aria-hidden="true">warning</span>
      <span>{{ 'supprimer_playlist_confirmer' | transloco }}</span>
    </div>

    <div class="modal-actions">
      <button
        type="button"
        class="btn btn-secondary"
        ngbAutofocus
        (click)="modal.dismiss('Cancel click')"
      >
        {{ 'annuler' | transloco }}
      </button>
      <button type="button" class="btn btn-danger" (click)="onDeletePlaylist(modal)">
        <span class="material-icons" aria-hidden="true">delete_forever</span>
        {{ 'confirmer' | transloco }}
      </button>
    </div>
  </div>
</ng-template>

<ng-template #contentModalConfirmEditTitle let-modal>
  <div class="modal-header">
    <h4 class="modal-title">
      <span class="material-icons" aria-hidden="true">edit</span>
      {{ 'playlist_modifier_titre' | transloco }}
    </h4>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    ></button>
  </div>
  <div class="modal-body">
    <form (submit)="onEditTitlePlaylist($event, modal)" class="modal-form">
      <div class="form-group">
        <label class="form-label" for="playlist-title">
          <span class="material-icons" aria-hidden="true">title</span>
          {{ 'titre' | transloco }}
        </label>
        <input
          type="text"
          id="playlist-title"
          class="form-control"
          ngbAutofocus
          [formField]="editTitleForm.playlist_titre"
        />
      </div>

      <div class="modal-actions">
        <button type="submit" class="btn btn-primary" [disabled]="editTitleForm().invalid()">
          <span class="material-icons" aria-hidden="true">save</span>
          {{ 'modifier' | transloco }}
        </button>
      </div>
    </form>
  </div>
</ng-template>
