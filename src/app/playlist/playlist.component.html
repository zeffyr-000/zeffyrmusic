@if(!isLoading()){
<div
  id="playlist-content"
  class="card panel-profile border-0 h-auto mt-2"
  itemscope
  [attr.itemtype]="!idTopCharts() ? 'http://schema.org/MusicAlbum' : 'http://schema.org/MusicGroup'"
>
  @if(!isPrivate() && (!isLikePage() || playlist().length>0)){
  <div id="playlist-header" class="card-header clearfix border-0">
    <div class="panel-head-content row">
      @if(imgBig() && imgBig()!==undefined && imgBig()!=='') {
      <div id="playlist-image-wrapper" class="col col-4 p-0">
        <img
          id="playlist-image"
          [src]="imgBig()"
          class="rounded"
          alt=""
          appDefaultImage
          itemprop="image"
        />
      </div>
      }

      <div id="playlist-header-title" class="col col-8 p-0">
        @if(idTopCharts()===null && titre()!=='') {
        <h1 class="m-t-0 h3" itemprop="name">{{ titre() }}</h1>
        } @if(titre()==='') {
        <h1 class="m-t-0 h3" itemprop="name">{{ title() }}</h1>
        } @if(isLikePage()){
        <h1 class="m-t-0 h3">{{ 'mes_likes' | transloco }}</h1>
        } @if(artist()!==null && artist()!=='') {
        <h3 class="h4">
          <a itemprop="byArtist url" routerLink="/artist/{{ idArtist() }}">{{ artist() }}</a>
        </h3>
        } @if(titre()==='') {
        <p class="m-t-0" itemtype="description">{{ description() }}</p>
        }

        <div class="playlist-actions">
          @if(idPlaylist() !== currentIdPlaylistPlaying() || !playerStore.isPlaying()) {
          <button type="button" class="btn btn-primary btn-action" (click)="runPlaylist()">
            <span class="material-icons" aria-hidden="true">play_circle_outline</span>
            {{ 'lire' | transloco }}
          </button>
          } @else {
          <button type="button" class="btn btn-primary btn-action" (click)="pausePlaylist()">
            <span class="material-icons" aria-hidden="true">pause_circle_outline</span>
            {{ 'pause' | transloco }}
          </button>
          } @if(authStore.isAuthenticated() && idPersoOwner()!==authStore.idPerso() && idPlaylist()
          !=='') {
          <button
            type="button"
            class="btn btn-secondary btn-action"
            [class.active]="isFollower()"
            [attr.aria-pressed]="isFollower()"
            (click)="switchFollow()"
          >
            <span class="material-icons" aria-hidden="true">{{
              isFollower() ? 'favorite' : 'favorite_border'
            }}</span>
            {{ 'suivre' | transloco }}
          </button>
          }

          <button type="button" class="btn btn-secondary btn-action" (click)="addInCurrentList()">
            <span class="material-icons" aria-hidden="true">playlist_add</span>
            {{ 'ajouter_liste_en_cours' | transloco }}
          </button>

          @if(!isLikePage()) {
          <button
            type="button"
            class="btn btn-secondary btn-action"
            (click)="openShareModal(contentModalShare)"
          >
            <span class="material-icons" aria-hidden="true">share</span>
            {{ 'partager' | transloco }}
          </button>
          }
        </div>

        <div class="row m-t">
          <div id="playlist-info" class="col-md-6">
            <span class="badge rounded-pill bg-primary-subtle text-body-secondary">
              <strong class="text-primary">{{ playlist().length }}</strong>
              {{ 'track_count_label' | transloco : { count: playlist().length } }}
              <span class="mx-1">â€¢</span>
              {{ sumDurationPlaylist() }}
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card-body p-t-0">
    <table id="table-playlist" class="table table-hover">
      <thead>
        <tr>
          <th class="d-none d-md-table-cell"></th>
          <th class="d-none d-md-table-cell"></th>
          <th>
            <span class="d-none d-md-inline">{{ 'intitule_artiste' | transloco }}</span>
          </th>
          <th class="d-none d-md-table-cell">{{ 'intitule_titre' | transloco }}</th>
          <th class="d-none d-md-table-cell"></th>
          <th></th>
        </tr>
      </thead>

      <tbody>
        @for (video of playlist(); track video.id_video; let i = $index) {
        <tr
          [attr.data-id-video]="video.key"
          (click)="runPlaylist(i)"
          [class.active]="video.key === queueStore.currentKey()"
          itemprop="track"
          itemscope
          itemtype="http://schema.org/MusicRecording"
        >
          <td class="d-none d-md-table-cell" itemprop="position">{{ i + 1 }}</td>
          <td class="d-none d-md-table-cell">
            <img
              [appLazyLoadImage]="'https://img.youtube.com/vi/' + video.key + '/mqdefault.jpg'"
              class="thumbnail"
              alt=""
            />
          </td>
          <td>
            <p class="d-block d-md-none" itemprop="name">
              <strong>{{ video.titre }}</strong>
            </p>
            <app-artist-list [artists]="video.artists"></app-artist-list>
          </td>
          <td class="d-none d-md-table-cell" itemprop="name">{{ video.titre }}</td>
          <td class="d-none d-md-table-cell">
            @if(video.duree && +video.duree>0) {
            <span>{{ video.duree | toMMSS }}</span>
            }
          </td>
          <td>
            <div class="d-flex">
              @if(authStore.isAuthenticated() && userLibraryService.isLiked(video.key)) {
              <button
                type="button"
                class="btn btn-sm btn-link text-decoration-none"
                (click)="
                  $event.stopPropagation(); userLibraryService.removeLike(video.key).subscribe()
                "
              >
                <span class="material-icons">favorite</span>
              </button>
              } @if(authStore.isAuthenticated() && !userLibraryService.isLiked(video.key)) {
              <button
                type="button"
                class="btn btn-sm btn-link text-decoration-none text-body"
                (click)="
                  $event.stopPropagation(); userLibraryService.addLike(video.key).subscribe()
                "
              >
                <span class="material-icons">favorite_border</span>
              </button>
              }
              <span
                class="btn btn-link btn-sm text-decoration-none text-body"
                tabindex="-1"
                (click)="$event.stopPropagation()"
                (keydown.enter)="$event.stopPropagation()"
                (keydown.space)="$event.stopPropagation()"
                ngbDropdown
              >
                <button
                  class="btn btn-link p-0 text-body"
                  ngbDropdownToggle
                  aria-label="Menu actions"
                >
                  <span class="material-icons">more_vert</span>
                </button>
                <ul ngbDropdownMenu>
                  <li ngbDropdownItem>
                    <button
                      (click)="addVideoAfterCurrentInList(video)"
                      class="btn btn-link text-body text-decoration-none p-0"
                    >
                      <span class="material-icons">queue_music</span>
                      {{ 'ajouter_apres_courant' | transloco }}
                    </button>
                  </li>
                  <li ngbDropdownItem>
                    <button
                      (click)="addVideoInEndCurrentList(video)"
                      class="btn btn-link text-body text-decoration-none p-0"
                    >
                      <span class="material-icons">playlist_add</span>
                      {{ 'ajouter_liste_en_cours' | transloco }}
                    </button>
                  </li>
                  @if(authStore.isAuthenticated()) {
                  <li ngbDropdownItem>
                    <button
                      (click)="addVideo(video.key, video.artiste, video.titre, video.duree)"
                      class="btn btn-link text-body text-decoration-none p-0"
                    >
                      <span class="material-icons">add</span>
                      {{ 'ajouter_a_une_playlist' | transloco }}
                    </button>
                  </li>
                  } @if(authStore.isAuthenticated() && idPersoOwner()===authStore.idPerso()) {
                  <li ngbDropdownItem>
                    <button
                      (click)="removeVideo(video.id_video)"
                      class="btn btn-link text-body text-decoration-none p-0"
                    >
                      <span class="material-icons">clear</span>
                      {{ 'supprimer' | transloco }}
                    </button>
                  </li>
                  }
                </ul>
              </span>
            </div>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>
  } @if(isPrivate()) {
  <p class="bg-info p-2 rounded">{{ 'playlist_privee' | transloco }}</p>
  <p>
    <a routerLink="/">{{ 'back_home' | transloco }}</a>
  </p>
  } @if(isLikePage() && playlist().length===0) {
  <p class="bg-info p-2 rounded">{{ 'likes_empty' | transloco }}</p>
  }
</div>
} @else {
<div class="d-flex justify-content-center align-items-center">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
</div>
}

<!-- Share Modal -->
<ng-template #contentModalShare let-modal>
  <div class="modal-header">
    <h4 class="modal-title">
      <span class="material-icons" aria-hidden="true">share</span>
      {{ 'partager' | transloco }}
    </h4>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    ></button>
  </div>
  <div class="modal-body">
    <share-buttons
      [include]="['facebook', 'x', 'whatsapp', 'telegram', 'email', 'copy']"
      [showIcon]="true"
      [showText]="true"
    ></share-buttons>
  </div>
</ng-template>
